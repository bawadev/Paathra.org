# Paathra - Kamal Deployment Config
# Copy to bawadev/dhaana repo as config/deploy.yml
# Reference: server-credentials.md
# Uses Traefik (from Appwrite) for reverse proxy and SSL

service: paathra
image: ghcr.io/bawadev/paathra

servers:
  web:
    hosts:
      - 185.211.6.206
    labels:
      traefik.enable: "true"
      traefik.constraint-label-stack: "appwrite"
      traefik.http.routers.paathra.rule: "Host(\`dev.paathra.org\`)"
      traefik.http.routers.paathra.entrypoints: "appwrite_websecure"
      traefik.http.routers.paathra.tls: "true"
      traefik.http.routers.paathra.tls.certresolver: "dns"
      traefik.http.services.paathra.loadbalancer.server.port: "3000"
      traefik.docker.network: "gateway"
    options:
      network: gateway

registry:
  server: ghcr.io
  username: bawadev
  password:
    - KAMAL_REGISTRY_PASSWORD

ssh:
  user: root

# Disable kamal-proxy - using Traefik instead
proxy: false

env:
  clear:
    NODE_ENV: production
    NEXT_PUBLIC_SUPABASE_URL: https://nosxuzuvckyqbbzpgnsl.supabase.co
  secret:
    - KAMAL_REGISTRY_PASSWORD
    - NEXT_PUBLIC_SUPABASE_ANON_KEY
    - SUPABASE_SERVICE_ROLE_KEY
    - SUPABASE_SECRET_KEY
    - SUPABASE_JWT_SECRET

builder:
  arch: amd64
